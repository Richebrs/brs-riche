<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - BRS Riche</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    body {
      font-family:'Segoe UI',sans-serif;
      margin:0; padding:0;
      background:#f4f7fb;
      color:#333;
      -webkit-user-select:none; -moz-user-select:none; user-select:none;
      overflow-x:hidden;
    }

    header {
      background: linear-gradient(135deg,#0d47a1,#1976d2);
      color:#fff;
      padding:20px;
      text-align:center;
      border-bottom-left-radius:14px;
      border-bottom-right-radius:14px;
    }

    header h1 { margin:0; font-size:1.6em; }

    .stats {
      display:flex;
      justify-content:space-around;
      margin-top:15px;
      flex-wrap:wrap;
    }

    .stat-card {
      flex:1 1 120px;
      max-width:150px;
      background:#fff;
      color:#0d47a1;
      border-radius:12px;
      padding:15px;
      margin:6px;
      text-align:center;
      box-shadow:0 6px 14px rgba(0,0,0,0.15);
    }

    .stat-card h3 { margin:6px 0; font-size:1em; }
    .stat-card p { margin:0; font-weight:bold; font-size:1.2em; }

    .action-buttons {
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      margin:20px 0;
      gap:10px;
    }

    .btn-action {
      display:inline-block;
      padding:12px 18px;
      border-radius:12px;
      font-weight:bold;
      text-decoration:none;
      color:#fff;
      transition:.3s;
      min-width:120px;
      text-align:center;
    }

    .btn-deposit { background:#2e7d32; }
    .btn-withdraw { background:#c62828; }
    .btn-history { background:#1565c0; }
    .btn-hotels { background:#f57f17; color:#fff; }
    .btn-residences { background:#6a1b9a; color:#fff; }

    .btn-action:hover { opacity:0.85; transform:translateY(-2px); }

    #productGrid {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
      gap:15px;
      margin-top:20px;
    }

    .product-card {
      background:#fff;
      border-radius:14px;
      padding:12px;
      box-shadow:0 8px 24px rgba(0,0,0,0.08);
      text-align:center;
    }

    .product-card img {
      width:100%;
      border-radius:12px;
      height:140px;
      object-fit:cover;
    }

    .product-card h4 { margin:10px 0 5px; font-size:1em; }
    .product-card p { margin:0; font-size:.9em; color:#555; }

    @media(max-width:768px){
      .stats { flex-direction:column; align-items:center; }
      .action-buttons { flex-direction:column; }
      .btn-action { width:90%; max-width:280px; }
    }
  </style>
</head>
<body oncopy="return false" oncut="return false" onpaste="return false" oncontextmenu="return false">

<header>
  <h1>ðŸ’¸ Bienvenue, <span id="userName">Utilisateur</span></h1>
  <div class="stats">
    <div class="stat-card">
      <h3>Disponible</h3>
      <p id="availableBalance">0 USDT</p>
    </div>
    <div class="stat-card">
      <h3>RetirÃ©</h3>
      <p id="withdrawn">0 USDT</p>
    </div>
    <div class="stat-card">
      <h3>Total Gains</h3>
      <p id="totalEarnings">0 USDT</p>
    </div>
  </div>
</header>

<div class="container">

  <!-- ACTIONS RAPIDES -->
  <div class="action-buttons">
    <a href="deposit.html" class="btn-action btn-deposit"><i class="fas fa-arrow-up"></i> DÃ©pÃ´t</a>
    <a href="withdraw.html" class="btn-action btn-withdraw"><i class="fas fa-arrow-down"></i> Retrait</a>
    <a href="history.html" class="btn-action btn-history"><i class="fas fa-history"></i> Historique</a>
    <a href="hotels.html" class="btn-action btn-hotels"><i class="fas fa-hotel"></i> Hotels</a>
    <a href="residences.html" class="btn-action btn-residences"><i class="fas fa-building"></i> Residences</a>
  </div>

  <!-- PRODUITS (PUBLIC ET PRIVÃ‰) -->
  <div id="productGrid">
    <!-- Les cartes des hÃ´tels et rÃ©sidences sâ€™afficheront ici -->
    <p style="text-align:center; width:100%;">Chargement des produits...</p>
  </div>

</div>

<script src="firebase-init.js"></script>
<script>
  let user = null;

  firebase.auth().onAuthStateChanged(async u => {
    if(u){ 
      user = u;
      document.getElementById('userName').innerText = user.email.split('@')[0];
      await loadUserStats();
      await loadProducts();
    } else { 
      window.location.href="login.html"; 
    }
  });

  async function loadUserStats(){
    const db = firebase.firestore();
    const uid = user.uid;
    const userDoc = await db.collection('users').doc(uid).get();
    if(userDoc.exists){
      const data = userDoc.data();
      document.getElementById('availableBalance').innerText = (data.balance || 0).toFixed(2)+" USDT";
      document.getElementById('withdrawn').innerText = (data.withdrawn || 0).toFixed(2)+" USDT";
      document.getElementById('totalEarnings').innerText = (data.totalEarnings || 0).toFixed(2)+" USDT";
    }
  }

  async function loadProducts(){
    const db = firebase.firestore();
    const grid = document.getElementById('productGrid');
    grid.innerHTML = '';

    // Exemple : rÃ©cupÃ©rer tous les hÃ´tels disponibles
    const hotelsSnapshot = await db.collection('hotels').where('status','==','available').get();
    hotelsSnapshot.forEach(doc=>{
      const h = doc.data();
      grid.innerHTML += `<div class="product-card">
        <img src="${h.image}" alt="${h.name}">
        <h4>${h.name}</h4>
        <p>${h.description || ''}</p>
      </div>`;
    });

    // Idem pour les rÃ©sidences
    const resSnapshot = await db.collection('residences').where('status','==','available').get();
    resSnapshot.forEach(doc=>{
      const r = doc.data();
      grid.innerHTML += `<div class="product-card">
        <img src="${r.image}" alt="${r.name}">
        <h4>${r.name}</h4>
        <p>${r.description || ''}</p>
      </div>`;
    });

    if(grid.innerHTML === ''){
      grid.innerHTML = '<p style="text-align:center; width:100%;">Aucun produit disponible.</p>';
    }
  }

  // Bloquer zoom (ctrl + molette)
  document.addEventListener('wheel', function(e){ if(e.ctrlKey) e.preventDefault(); }, {passive:false});
  document.addEventListener('keydown', function(e){
    if((e.ctrlKey||e.metaKey) && ['+','-','0'].includes(e.key)) e.preventDefault();
  });

</script>

</body>
  </html>
  
